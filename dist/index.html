<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Solitaire</title><style>html{box-sizing:border-box}*,:after,:before{box-sizing:inherit}body,html{width:100%;height:100%;margin:0;border:0;padding:0}body{overflow:hidden;background-color:#000}.app-canvas,.app-container{margin:0;border:0;padding:0}.app-canvas{width:100%;height:100%;background-color:#61ad4a}</style></head><body><div class="app-container js-app-container"><canvas class="app-canvas js-app-canvas">Your browser does not support canvas elements.</canvas></div><script>!function(t){function e(s){if(i[s])return i[s].exports;var o=i[s]={exports:{},id:s,loaded:!1};return t[s].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function o(){var t=document.body,e=document.querySelector(".js-app-container"),i=document.querySelector(".js-app-canvas"),s=(0,b.default)(k,T,t.offsetWidth,t.offsetHeight);e.style.width=s.width+"px",e.style.height=s.height+"px",i.width=s.width,i.height=s.height;var o=t.offsetWidth-s.width,n=t.offsetHeight-s.height;e.style.marginLeft=Math.floor(o/2)+"px",e.style.marginRight=Math.ceil(o/2)+"px",e.style.marginTop=Math.floor(n/2)+"px",e.style.marginBottom=Math.ceil(n/2)+"px"}var n=i(11),h=s(n),a=i(10),r=s(a),l=i(5),u=s(l),d=i(13),c=s(d),p=i(2),f=(s(p),i(4)),g=s(f),v=i(14),m=s(v),y=i(17),P=s(y),w=i(1),x=s(w),S=i(12),b=s(S),C=i(16),M=s(C);console.log("Hello");var k=16,T=9,A=document.querySelector(".js-app-canvas"),L=A.getContext("2d"),z=new m.default;z.start();var E,H,W,I,O,N;new r.default(h.default,function(t){console.log("Images loaded"),E=t,H=new u.default(E.suits,{x:0,y:0},{x:17,y:19},{x:1,y:0},{clubs:{x:0,y:0},spades:{x:1,y:0},diamonds:{x:2,y:0},hearts:{x:3,y:0}}),W=new c.default(E.font5x14,{x:1,y:1},{x:5,y:14},{x:1,y:1},["AaBbCcDdEeFfGgHhIiJjKkLlMm","NnOoPpQqRrSsTtUuVvWwXxYyZz","`1234567890-=[]\\;',./ ",'~!@#$%^&*()_+{}|:"<>?']),I=new g.default([{top:.15,bottom:.15,type:"mainTitle",text:"Solitaire"},{top:0,bottom:.05,type:"button",text:"Play",id:"play"},{type:"button",text:"About",id:"about"}],{font:W,parent:A,mousedownTracker:z,aspectWidth:k,aspectHeight:T,listeners:[{id:"play",event:"up",action:function(){I.stop(function(){N=new M.default({seed:Math.floor((new Date).getTime()*Math.random()*.007),ctx:L,font:W,suitSpriter:H,mousedownTracker:z,quitCallback:function(){I.start(L)}}),N.newGame(),L.clearRect(0,0,A.width,A.height),N.start()})}},{id:"about",event:"up",action:function(){I.stop(function(){L.clearRect(0,0,A.width,A.height),console.log("Go to About menu"),O.start(L)})}}]}),O=new g.default([{top:.08,bottom:.01,type:"title",text:"Solitaire"},{top:0,bottom:.08,type:"subtitle",text:"Version 0.1.0"},{top:0,bottom:.05,type:"button",text:"Author: Costava",id:"author"},{top:0,bottom:.05,type:"button",text:"View source on GitHub",id:"source"},{type:"button",text:"Back",id:"back"}],{font:W,parent:A,mousedownTracker:z,aspectWidth:k,aspectHeight:T,listeners:[{id:"author",event:"up",action:function(){console.log("See author"),window.open("https://github.com/Costava","_blank")}},{id:"source",event:"up",action:function(){console.log("See source"),window.open("https://github.com/Costava/solitaire","_blank")}},{id:"back",event:"up",action:function(){O.stop(function(){L.clearRect(0,0,A.width,A.height),console.log("Go back to main menu"),I.start(L)})}}]}),I.start(L)});var U=new P.default(o,150),j=new x.default(window,"resize",U.set.bind(U));j.start(),o()},function(t,e){"use strict";function i(t,e,i){this.target=t,this.eventType=e,this.work=i,this.active=!1}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.start=function(){this.active||(this.target.addEventListener(this.eventType,this.work),this.active=!0)},i.prototype.stop=function(){this.active&&(this.target.removeEventListener(this.eventType,this.work),this.active=!1)},e.default=i},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){t.mozImageSmoothingEnabled=e,t.webkitImageSmoothingEnabled=e,t.msImageSmoothingEnabled=e,t.imageSmoothingEnabled=e}},function(t,e){"use strict";function i(t){this.regWork=t.regWork,this.finalWork=t.finalWork,this.stopCallback=t.stopCallback||i.default.stopCallback,this.interval=t.interval||i.default.interval,this.maxNumIntervals=t.maxNumIntervals||i.default.maxNumIntervals,this.time=0,this.totalTime=0,this.looping=!1,this.stopped=!0,this.loopCallBound=this.loopCall.bind(this)}Object.defineProperty(e,"__esModule",{value:!0}),i.default={stopCallback:function(){},interval:8,maxNumIntervals:4},i.prototype.accumulate=function(t){this.time+=t,this.totalTime+=t},i.prototype.loopCall=function(){this.newTime=(new Date).getTime(),this.dt=this.newTime-this.oldTime,this.accumulate(this.dt);var t,e=Math.floor(this.time/this.interval),i=Math.min(e,this.maxNumIntervals);for(t=0;t<i;t+=1){var s=this.regWork();if(!s){t+=1;break}}t>0&&(this.time-=t*this.interval,this.finalWork()),this.oldTime=this.newTime,this.looping?window.requestAnimationFrame(this.loopCallBound):(this.stopped=!0,this.stopCallback())},i.prototype.start=function(){this.stopped&&(this.oldTime=(new Date).getTime(),this.looping=!0,this.stopped=!1,this.loopCallBound())},i.prototype.stop=function(){this.looping=!1},i.prototype.clearTime=function(){this.time=0},i.prototype.resetTime=function(){this.time=0,this.totalTime=0},e.default=i},function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function o(t,e){this.elements=t,this.options=e,"number"!=typeof this.options.xCenter&&(this.options.xCenter=.5*this.options.aspectWidth/this.options.aspectHeight),this.running=!1,this.armed=!1;var i=0;this.elements.forEach(function(t){i+=t.top||0,t.y=i;var e=this.styles[t.type].fontSize,s=this.options.font.getStringSize(t.text);t.width=s.width/s.height*e,o.isButton(t)&&(t.width+=2*this.styles[t.type].padding,t.buttonState="normal",i+=2*this.styles[t.type].padding),t.x=-t.width/2+this.options.xCenter,i+=e,t.height=i-t.y,i+=t.bottom||0}.bind(this)),this.mousemoveLS=new r.default(window,"mousemove",o.handleMousemove.bind(this)),this.mousedownLS=new r.default(window,"mousedown",o.handleMousedown.bind(this)),this.mouseupLS=new r.default(window,"mouseup",o.handleMouseup.bind(this))}Object.defineProperty(e,"__esModule",{value:!0});var n=i(3),h=s(n),a=i(1),r=s(a),l=i(9),u=s(l),d=i(6),c=s(d),p=i(7),f=s(p),g=i(8),v=s(g);o.prototype.styles={mainTitle:{fontSize:.15},title:{fontSize:.1},subtitle:{fontSize:.06},button:{fontSize:.07,padding:.015,backgroundColor:{normal:"rgb(255, 255, 255)",hover:"rgb(220, 220, 220)",down:"rgb(53, 94, 41)"}},gameButton:{fontSize:.0455,padding:.012,backgroundColor:{normal:"rgb(255, 255, 255)",hover:"rgb(220, 220, 220)",down:"rgb(53, 94, 41)"}}},o.isButton=function(t){return"button"==t.type||"gameButton"==t.type},o.prototype.draw=function(t){t.save(),this.elements.forEach(function(e){t.save(),t.translate(e.x*t.canvas.height,e.y*t.canvas.height),o.isButton(e)?this.drawButton(t,e):this.drawFontElement(t,e),t.restore()}.bind(this)),t.restore()},o.prototype.drawFontElement=function(t,e){t.save();var i=this.styles[e.type].fontSize,s=i*t.canvas.height/this.options.font.size.y;t.scale(s,s),this.options.font.drawString(t,e.text),t.restore()},o.prototype.drawButton=function(t,e){t.save(),t.scale(t.canvas.height,t.canvas.height),t.fillStyle=this.styles[e.type].backgroundColor[e.buttonState],t.fillRect(0,0,e.width,e.height),t.restore(),t.save(),t.translate(this.styles[e.type].padding*t.canvas.height,this.styles[e.type].padding*t.canvas.height),this.drawFontElement(t,e),t.restore()},o.prototype.start=function(t){this.running||(this.ctx=t,this.arm(),this.dualLooper=new h.default({regWork:function(){},finalWork:function(){this.draw(this.ctx)}.bind(this)}),this.dualLooper.start(),this.running=!0)},o.prototype.stop=function(t){this.running&&(this.disarm(),this.stopWork=t,this.dualLooper.stopCallback=function(){this.running=!1,this.stopWork()}.bind(this),this.dualLooper.stop())},o.prototype.arm=function(){this.armed||(this.mousemoveLS.start(),this.mousedownLS.start(),this.mouseupLS.start(),this.armed=!0)},o.prototype.disarm=function(){this.armed&&(this.mousemoveLS.stop(),this.mousedownLS.stop(),this.mouseupLS.stop(),this.armed=!1)},o.handleMousemove=function(t){var e=(0,f.default)((0,c.default)(t),this.options.parent);this.updateButtonStates(e)},o.handleMousedown=function(t){var e=(0,f.default)((0,c.default)(t),this.options.parent);this.updateButtonStates(e)},o.handleMouseup=function(t){var e=(0,f.default)((0,c.default)(t),this.options.parent);this.updateButtonStates(e);for(var i=0;i<this.elements.length;i+=1){var s=this.elements[i];if(o.isButton(s)){var n=(0,v.default)(s,e);if(n)for(var h=0;h<this.options.listeners.length;h+=1){var a=this.options.listeners[h];a.id==s.id&&"up"==a.event&&a.action()}}}},o.prototype.updateButtonStates=function(t){for(var e=!1,i=0;i<this.elements.length;i+=1){var s=this.elements[i];if(o.isButton(s)){var n=(0,v.default)(s,t);n?(e=!0,this.options.mousedownTracker.mousedown?s.buttonState="down":s.buttonState="hover"):s.buttonState="normal"}}e?(0,u.default)("pointer"):(0,u.default)("")},e.default=o},function(t,e){"use strict";function i(t,e,i,s,o){this.image=t,this.origin=e,this.size=i,this.margin=s,this.map=o}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.getSpriteOrigin=function(t){return{x:this.origin.x+t.x*(this.size.x+this.margin.x),y:this.origin.y+t.y*(this.size.y+this.margin.y)}},i.prototype.drawSprite=function(t,e){var i=this.map[e],s=this.getSpriteOrigin(i);t.drawImage(this.image,s.x,s.y,this.size.x,this.size.y,0,0,this.size.x,this.size.y)},e.default=i},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return{x:t.pageX,y:t.pageY}}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){return{x:(t.x-e.offsetLeft)/e.offsetHeight,y:(t.y-e.offsetTop)/e.offsetHeight}}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(e.x>t.x&&e.y>t.y){var i=e.x-t.x,s=e.y-t.y;if(i<t.width&&s<t.height)return!0}return!1}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){document.body.style.cursor=t}},function(t,e){"use strict";function i(t,e){this.callback=e,this.totalImages=Object.keys(t).length,this.imagesLoaded=0,this.result={},this.doneLoading=!1;for(var i in t){var s=new Image;s.addEventListener("load",function(){this.loader.imagesLoaded+=1,this.loader.result[this.name]=this,this.loader.check()}),s.loader=this,s.name=i,s.src=t[i]}}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.check=function(){this.doneLoading||this.totalImages!=this.imagesLoaded||(this.doneLoading=!0,this.callback(this.result))},e.default=i},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={font5x14:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJ0AAAA9CAYAAAC3Oms4AAAEGUlEQVR42u1d25KsIAwkU/7/L/e+7Kma43JJQoKo3S9b5WLE2OQCgSmFIBZDfv+i878a0JEjivZe+bV2EiC/1h5f1z3ypdHPCP2MnhfRH4881f1H4yVhIKymk1YlrpavUbosGvxS7omeAfgPHxr71yGL2KKVTdLdhygR92VbUpXsY+LFsMj1ZPUHg9gWg7BDnETx6E0CSLCN6x7FdL0At/VCMCgsIgHo3aftvza2kgn9zBABQffNJG0RrhylFDmMI8yTYESPYknuT0nuz5UzFaMEKaP/fxKMwzgK3hQPPRHSsD6rngkN6e40kqPjobcQb8V0jbRiuqiAGEo5YrieIT/KYkYMxFECs8KCy0RsTrzYleMOoQXn6QiSjnhHUEnEulPZqE/8vgTRS5c1pS2WEb66vXUZbLY/U6U+D2mv/l6HQfBI6bu1t5YueQYnUScYtImEFM7eE3+5ED7QPp2HESSRN5Hpyj8WdjCbzJasTYKyPM9KwtXEk6T2ar4cwR/TWkoUmWCIMQCOKM2yxnqt/p0XxWcSvN57ZcpXfy/Pgr8Y269MMEZVFBIxUm8INAZni+xRbrWaYHxuoKwItyLKePVfG2wS245CnYgihCzCff8P3212J50nsendI8EkXR231j40lNetciL7KN+6PxKsEJLlRJcSlTJfziMNF9aKO2vye5W9PdelfZbF7XoGdHZp2Tbuk9M7N/x+rDIhloOkI5bjoAoIhjPE46GdUR/NEWk22YgyTb/y+uzoF4V+xPmMzE3Q25nO2kQpDPf22s9Oi1jlw9j/CJeDgOdg0bdenkj0JhqjrAI9i21wZxmXS7/f0VCKkFxDy0DdBGavlrU4y8lGs5u2I05J8pIrkmCaM0Uea+VapCtl7kSgVunOiKylY2W91SfWA4DkQkvXq8d7lFU97jxiLsjys63d463cOZEgnkXsbUHS7ZXJWkvDoby+lWeynE93jjkQoEQo4rKZJCCy/UxCRRCPAYlNEARBEARBbB2sepaSoAh8R9v9elMC6DxT++zMoB5BCQCC+rvN1srPYvLWSGz5hcPzlrbaLxW2av9au6yi3i1T/soB8RjSnddUW/NZSFDq6GiJ2YKAqzxK7b6RjO1+pql3xoXXFWj2UY6I4tmP+YYlpdqEtDT+Jzu/ABoE0MZWvRgERb90M7JclpjOUtmriYcQIH82prNWVs9a03Sfr+koBvGahZAwKhEOwkS5TATJ166Zet0xHEnb8phOnK4JpV4DpzXrnjPddju4cVSCnvnTR9KI6aTojki7PKbzBp8S/NF2jsdkQ9lag7GNXjXZa88ki8HFoJEkeJRiKYK8yhLtGLfj7p21JhJFEYPA2J+ZeOwuk8OPIx13NI3JIEnPoe6Jy8n9GrBcnSDpCIIgwvEDV7H1CorcrpoAAAAASUVORK5CYII=",suits:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEcAAAATCAYAAADCrxD+AAAA7UlEQVRYw9VYyw7EIAgE0v//ZfbUZLPRdWTGakl6KUic4SFq1pdsfIyw628nEj+IeAGIk8S4ghgn/KByFSKckwCTXC/PtG9i/+lj/d40JfYLAimvns39f6SPDcRIe1C1NyH62ETMlN0owqskGqcTCkpVMo+dPlVyUpQhqc40tjxYclTzyxFz0KqyOk6S6EnsHORmfjQ5KMCeXZWgp+ac1xDcso+3g0PAVzMwBKO8s3cm0Xo5yTHYmIN6E/tZ0lNm/VwTkXNRBvjuMkVv96ONpgjUcU8WaZYjH7Fh+j1i2AMb+fS0yrzl0OWFRFwlH0+EVh6LhLYsAAAAAElFTkSuQmCC"}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,i,s){if(i<=0||s<=0)return{width:0,height:0};if(t<0||e<0||0===t&&0===e)return{width:0,height:0};if(0===t)return{width:0,height:s};if(0===e)return{width:i,height:0};var o,n,h=t/e,a=i/s;if(h===a)o=i,n=s;else if(h<a){var r=Math.floor(s/e);o=r*t,n=r*e}else if(h>a){var r=Math.floor(i/t);o=r*t,n=r*e}else console.log("Unknown MaxChildSize condition. "+("childAspectWidth: "+t+", ")+("childAspectHeight: "+e+", ")+("parentWidth: "+i+", ")+("parentHeight: "+s));return{width:o,height:n}}},function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function o(t,e,i,s,o){this.image=t,this.origin=e,this.size=i,this.margin=s,this.map={};for(var n=0;n<o.length;n+=1)for(var a=o[n],r=0;r<a.length;r+=1){var l=a[r];this.map[l]={x:r,y:n}}this.spriter=new h.default(this.image,this.origin,this.size,this.margin,this.map)}Object.defineProperty(e,"__esModule",{value:!0});var n=i(5),h=s(n),a=i(2),r=s(a);o.prototype.drawChar=function(t,e){t.save(),(0,r.default)(t,!1);try{this.spriter.drawSprite(t,e)}catch(e){this.spriter.drawSprite(t,"?")}t.restore()},o.prototype.drawString=function(t,e){t.save();for(var i=0;i<e.length;i+=1)this.drawChar(t,e[i]),t.translate(this.size.x+this.margin.x,0);t.restore()},o.prototype.getStringSize=function(t){return{width:t.length*this.size.x+(t.length-1)*this.margin.x,height:this.size.y}},e.default=o},function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function o(){this.mousedown=!1,this.mousedownLS=new h.default(window,"mousedown",function(){this.mousedown=!0}.bind(this)),this.mouseupLS=new h.default(window,"mouseup",function(){this.mousedown=!1}.bind(this))}Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),h=s(n);o.prototype.start=function(){this.mousedownLS.start(),this.mouseupLS.start()},o.prototype.stop=function(){this.mousedownLS.stop(),this.mouseupLS.stop()},e.default=o},function(t,e){"use strict";function i(t){this.seed=t||10}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.random=function(){this.seed+=1;var t=1e5*Math.sin(this.seed);return t-Math.floor(t)},i.prototype.randomInt=function(t,e){return Math.floor(this.random()*(e-t+1))+t},i.prototype.randomInRange=function(t,e){return this.random()*(e-t)+t},e.default=i},function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function o(t){this.ctx=t.ctx,this.font=t.font,this.suitSpriter=t.suitSpriter,this.mousedownTracker=t.mousedownTracker,this.quitCallback=t.quitCallback,this.srng=new h.default(t.seed),this.aspectWidth=t.aspectWidth||16,this.aspectHeight=t.aspectHeight||9,this.oldPos=null,this.running=!1,this.armed=!1,this.labelMargin=.01,this.fontHeight=.04,this.cardWidth=.18,this.cardHeight=.27,this.horizSpace=.036,this.facedownSpacing=.02,this.faceupSpacing=this.getFaceupSpacing(),this.pilesY=this.getPilesY(),this.horizMargin=this.getHorizMargin(),this.turnPilePos=this.getTurnPilePos(),this.turnedPilePos=this.getTurnedPilePos(),this.buttonsPos=this.getButtonsPos(),this.foundationsPos=this.getFoundationsPos(),this.pileBasePos=this.getPileBasePos(),this.mousemoveLS=new u.default(window,"mousemove",o.handleMousemove.bind(this)),this.mousedownLS=new u.default(window,"mousedown",o.handleMousedown.bind(this)),this.mouseupLS=new u.default(window,"mouseup",o.handleMouseup.bind(this)),this.touchmoveLS=new u.default(window,"touchmove",o.handleTouchmove.bind(this)),this.touchstartLS=new u.default(window,"touchstart",o.handleTouchstart.bind(this)),this.touchendLS=new u.default(window,"touchend",o.handleTouchend.bind(this)),this.buttonsMenu=new c.default([{top:2.34*this.horizSpace,type:"gameButton",text:"Quit",id:"quit"},{top:this.horizSpace,type:"gameButton",text:"New Game",id:"newgame"}],{font:this.font,parent:this.ctx.canvas,mousedownTracker:this.mousedownTracker,aspectWidth:this.aspectWidth,aspectHeight:this.aspectHeight,xCenter:this.horizMargin+2.5*this.cardWidth+2*this.horizSpace,listeners:[{id:"quit",event:"up",action:function(){console.log("Quit"),this.stop(function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.quitCallback()}.bind(this))}.bind(this)},{id:"newgame",event:"up",action:function(){this.newGame()}.bind(this)}]})}Object.defineProperty(e,"__esModule",{value:!0});var n=i(15),h=s(n),a=i(3),r=s(a),l=i(1),u=s(l),d=i(4),c=s(d),p=i(9),f=s(p),g=i(2),v=s(g),m=i(6),y=s(m),P=i(18),w=s(P),x=i(7),S=s(x),b=i(8),C=s(b);o.RANKS=["A","2","3","4","5","6","7","8","9","10","J","Q","K"],o.SUITS=["clubs","diamonds","spades","hearts"],o.NUM_FOUNDATIONS=4,o.NUM_PILES=7,o.prototype.getFaceupSpacing=function(){return this.labelMargin+this.fontHeight},o.prototype.getPilesY=function(){return this.cardHeight+2*this.horizSpace},o.prototype.getHorizMargin=function(){return(1*(this.aspectWidth/this.aspectHeight)-7*this.cardWidth-6*this.horizSpace)/2},o.prototype.getTurnPilePos=function(){return{x:this.horizMargin,y:this.horizSpace,width:this.cardWidth,height:this.cardHeight}},o.prototype.getTurnedPilePos=function(){return{x:this.horizMargin+this.cardWidth+this.horizSpace,y:this.horizSpace,width:this.cardWidth,height:this.cardHeight}},o.prototype.getButtonsPos=function(){return{x:this.horizMargin+2*this.cardWidth+2*this.horizSpace,y:this.turnedPilePos.y,width:this.cardWidth,height:this.cardHeight}},o.prototype.getFoundationsPos=function(){for(var t=[],e=this.horizSpace,i=0;i<o.NUM_FOUNDATIONS;i+=1){var s=this.aspectWidth/this.aspectHeight-this.horizMargin;s-=(o.NUM_FOUNDATIONS-i)*this.cardWidth,s-=(o.NUM_FOUNDATIONS-i-1)*this.horizSpace,t.push({x:s,y:e,width:this.cardWidth,height:this.cardHeight,foundation:i,type:"FOUNDATION",location:null})}return t},o.prototype.getPileBasePos=function(){for(var t=[],e=0;e<o.NUM_PILES;e+=1){var i={};i.y=this.pilesY,i.x=this.horizMargin+e*(this.cardWidth+this.horizSpace),i.width=this.cardWidth,i.height=this.cardHeight,i.pile=e,i.type="PILE",i.location=null,t.push(i)}return t},o.prototype.newGame=function(){console.log("New game. Seed:",this.srng.seed),this.heldCard=null,this.hoverPos=null,this.foundations=[[],[],[],[]];var t=this.getShuffledDeck();this.piles=o.getNewPiles(t),this.turnPile=t,this.turnedPile=[],this.updateTurnPileCards(),this.updatePileCardPositions()},o.prototype.start=function(){this.running||(console.log("Start Solitaire"),this.arm(),this.dualLooper=new r.default({regWork:function(){},finalWork:function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.drawTurnPile(),this.drawTurnedPile(),this.drawPiles(),this.drawFoundations(),this.buttonsMenu.draw(this.ctx),this.drawHoverPos(),this.drawHeldCards()}.bind(this)}),this.dualLooper.start(),this.running=!0)},o.prototype.stop=function(t){this.running&&(console.log("Stop Solitaire"),this.disarm(),this.stopWork=t,this.dualLooper.stopCallback=function(){this.running=!1,this.stopWork()}.bind(this),this.dualLooper.stop())},o.prototype.arm=function(){this.armed||(this.mousemoveLS.start(),this.mousedownLS.start(),this.mouseupLS.start(),this.touchmoveLS.start(),this.touchstartLS.start(),this.touchendLS.start(),this.armed=!0)},o.prototype.disarm=function(){this.armed&&(this.mousemoveLS.stop(),this.mousedownLS.stop(),this.mouseupLS.stop(),this.touchmoveLS.stop(),this.touchstartLS.stop(),this.touchendLS.stop(),this.armed=!1)},o.moveCard=function(t,e,i){null!=t&&(t.x+=e,t.y+=i,o.moveCard(t.next,e,i))},o.handleTouchmove=function(t){t.preventDefault();var e=(0,w.default)(t),i=(0,S.default)(e,this.ctx.canvas);null==this.oldPos?(t.movementX=0,t.movementY=0):(t.movementX=e.x-this.oldPos.x,t.movementY=e.y-this.oldPos.y),this.oldPos=e,(0,C.default)(this.buttonsPos,i)?c.default.handleMousemove.call(this.buttonsMenu,{pageX:e.x,pageY:e.y}):this.handleMove(t,e)},o.handleMousemove=function(t){var e=(0,y.default)(t),i=(0,S.default)(e,this.ctx.canvas);(0,C.default)(this.buttonsPos,i)?c.default.handleMousemove.call(this.buttonsMenu,{pageX:e.x,pageY:e.y}):this.handleMove(t,e)},o.prototype.handleMove=function(t,e){var i=(0,S.default)(e,this.ctx.canvas);if(null==this.heldCard&&(this.turnPile.length>0||this.turnedPile.length>0)&&(0,C.default)(this.turnPilePos,i))return void(0,f.default)("pointer");if(this.hoverPos=this.getHoverPos(i),null!=this.hoverPos&&"TURNED_PILE"==this.hoverPos.location&&null!=this.heldCard&&(this.hoverPos=null),null!=this.heldCard){var s=t.movementX/this.ctx.canvas.height,n=t.movementY/this.ctx.canvas.height;o.moveCard(this.heldCard,s,n)}null!=this.heldCard||null!=this.hoverPos?(0,f.default)("pointer"):(0,f.default)("")},o.handleTouchstart=function(t){t.preventDefault();var e=(0,w.default)(t),i=(0,S.default)(e,this.ctx.canvas);this.oldPos=e,(0,C.default)(this.buttonsPos,i)?c.default.handleMousedown.call(this.buttonsMenu,{pageX:e.x,pageY:e.y}):this.handleDown(e)},o.handleMousedown=function(t){var e=(0,y.default)(t),i=(0,S.default)(e,this.ctx.canvas);(0,C.default)(this.buttonsPos,i)?c.default.handleMousedown.call(this.buttonsMenu,{pageX:e.x,pageY:e.y}):this.handleDown(e)},o.prototype.handleDown=function(t){var e=(0,S.default)(t,this.ctx.canvas);if(this.turnPile.length>0||this.turnedPile.length>0){if((0,C.default)(this.turnPilePos,e))return this.turnPile.length>0?this.turnCard():this.resetTurnPile(),this.turnPile.length>0||this.turnedPile.length>0?(0,f.default)("pointer"):(0,f.default)(""),void(this.hoverPos=null);if((0,C.default)(this.turnedPilePos,e)&&null==this.heldCard)return this.heldCard=this.turnedPile.pop(),this.heldCard.location="HELD",this.heldCard.fromTurnedPile=!0,this.hoverPos=null,void(0,f.default)("pointer")}var i=this.getHoverPos(e);null==this.heldCard&&null!=i?(this.heldCard=i,this.removeCardFromPile(this.heldCard),this.hoverPos=this.getHoverPos(e)):this.hoverPos=i,null!=this.heldCard||null!=this.hoverPos?(0,f.default)("pointer"):(0,f.default)("")},o.handleTouchend=function(t){t.preventDefault();var e=(0,w.default)(t),i=(0,S.default)(e,this.ctx.canvas);this.oldPos=e,(0,C.default)(this.buttonsPos,i)?c.default.handleMouseup.call(this.buttonsMenu,{pageX:e.x,pageY:e.y}):this.handleUp(e)},o.handleMouseup=function(t){var e=(0,y.default)(t),i=(0,S.default)(e,this.ctx.canvas);(0,C.default)(this.buttonsPos,i)?c.default.handleMouseup.call(this.buttonsMenu,{pageX:e.x,pageY:e.y}):this.handleUp(e)},o.prototype.handleUp=function(t){var e=(0,S.default)(t,this.ctx.canvas);if(null==this.heldCard&&(this.turnPile.length>0||this.turnedPile.length>0)&&((0,C.default)(this.turnPilePos,e)||(0,C.default)(this.turnedPilePos,e)))return void(0,f.default)("pointer");if(this.hoverPos=this.getHoverPos(e),null!=this.heldCard)if(o.canPutOn(this.hoverPos,this.heldCard)){if("FOUNDATION"==this.hoverPos.location||"FOUNDATION"==this.hoverPos.type){var i=this.foundations[this.hoverPos.foundation];this.heldCard.x=this.hoverPos.x,this.heldCard.y=this.hoverPos.y,this.heldCard.foundation=this.hoverPos.foundation,this.heldCard.location="FOUNDATION",i.push(this.heldCard)}else this.addCardToPile(this.hoverPos.pile,this.heldCard);if("number"==typeof this.heldCard.fromPile){var s=this.piles[this.heldCard.fromPile];s.length>0&&(s[s.length-1].facedown=!1)}this.heldCard.fromTurnedPile=!1}else if(this.heldCard.fromTurnedPile)this.turnedPile.push(this.heldCard),this.heldCard.location="TURNED_PILE",this.heldCard.fromTurnedPile=!1,this.heldCard.x=this.turnedPilePos.x,this.heldCard.y=this.turnedPilePos.y;else{var n=this.heldCard.fromPile;this.addCardToPile(n,this.heldCard)}this.updatePileCardPositions(),this.heldCard=null,this.hoverPos=this.getHoverPos(e),null!=this.hoverPos?(0,f.default)("pointer"):(0,f.default)("")},o.prototype.resetTurnPile=function(){if(0==this.turnPile.length&&this.turnedPile.length>0){this.turnPile=this.turnedPile.reverse(),this.turnedPile=[];for(var t=0;t<this.turnPile.length;t+=1){var e=this.turnPile[t];e.x=this.turnPilePos.x,e.y=this.turnPilePos.y,e.facedown=!0}}},o.prototype.turnCard=function(){if(this.turnPile.length>0){var t=this.turnPile.pop();t.facedown=!1,t.location="TURNED_PILE",t.x=this.horizMargin+this.cardWidth+this.horizSpace,t.y=this.horizSpace,this.turnedPile.push(t)}},o.canPutOn=function(t,e){if(null==t||null==e)return!1;if("PILE"==t.type&&12==e.rank)return!0;if("FOUNDATION"==t.type&&0==e.rank)return!0;if("FOUNDATION"==t.location&&e.rank==t.rank+1&&e.suit==t.suit)return!0;var i=t.suit%2!=e.suit%2;return!!i&&e.rank==t.rank-1},o.prototype.addCardToPile=function(t,e){if(null!=e){var i=this.piles[t];if(i.length>0){var s=i[i.length-1];s.next=e}e.pile=t,e.location="PILE",i.push(e),this.addCardToPile(t,e.next)}},o.prototype.removeCardFromPile=function(t){if(null!=t&&t.pile<this.piles.length){var e=this.piles[t.pile],i=e.indexOf(t);e.splice(i,1),e.length>0&&i>0&&(e[i-1].next=null),t.fromPile=t.pile,t.pile=null,this.removeCardFromPile(t.next)}},o.prototype.getHoverPos=function(t){if((0,C.default)(this.turnedPilePos,t)&&this.turnedPile.length>0){var e=this.turnedPile[this.turnedPile.length-1];return e}for(var i=0;i<this.foundations.length;i+=1){var s,n=this.foundations[i];if(s=0==n.length?this.foundationsPos[i]:n[n.length-1],null!=this.heldCard&&o.canPutOn(s,this.heldCard)&&(0,C.default)(s,t))return s}for(var h=0;h<this.piles.length;h+=1){var a=this.piles[h];if(0==a.length){if(null!=this.heldCard&&12==this.heldCard.rank){var r=this.pileBasePos[h];if((0,C.default)(r,t))return r}}else for(var l=a.length-1;l>=0;l-=1){var u=a[l];if((null!=this.heldCard&&o.canPutOn(u,this.heldCard)||null==this.heldCard)&&!u.facedown&&this.heldCard!=u&&(0,C.default)(u,t))return u}}return null},o.prototype.drawHoverPos=function(){if(null!=this.hoverPos){this.ctx.save();var t=.1;this.ctx.scale(this.ctx.canvas.height,this.ctx.canvas.height),this.ctx.translate(this.hoverPos.x-t*this.cardWidth,this.hoverPos.y-t*this.cardHeight),this.ctx.fillStyle="rgba(255, 255, 255, 0.4)",this.ctx.fillRect(0,0,(1+2*t)*this.cardWidth,(1+2*t)*this.cardHeight),this.ctx.restore()}},o.prototype.drawHeldCards=function(){this.tryDrawCard(this.heldCard)},o.prototype.tryDrawCard=function(t){null!=t&&(this.drawCard(t),this.tryDrawCard(t.next))},o.prototype.drawCard=function(t){t.facedown?this.drawFacedownCard(t):this.drawFaceupCard(t)},o.prototype.drawPiles=function(){for(var t=0;t<this.piles.length;t+=1)for(var e=this.piles[t],i=0;i<e.length;i+=1){var s=e[i];this.drawCard(s)}},o.prototype.drawFoundations=function(){for(var t=0;t<this.foundations.length;t+=1){var e=this.foundations[t];if(0==e.length){var i=this.foundationsPos[t];this.ctx.save(),this.ctx.scale(this.ctx.canvas.height,this.ctx.canvas.height),this.ctx.translate(i.x,i.y),this.ctx.fillStyle="rgb(100, 100, 100)",this.ctx.fillRect(0,0,this.cardWidth,this.cardHeight),this.ctx.restore()}else{var s=e[e.length-1];this.drawFaceupCard(s)}}},o.prototype.drawTurnPile=function(){if(this.turnPile.length>0){var t=this.turnPile[this.turnPile.length-1];this.drawCard(t)}else if(this.turnedPile.length>0){var e=this.turnPilePos;this.ctx.save(),this.ctx.scale(this.ctx.canvas.height,this.ctx.canvas.height),this.ctx.translate(e.x,e.y),this.ctx.fillStyle="rgb(100, 100, 100)",this.ctx.fillRect(0,0,this.cardWidth,this.cardHeight),this.ctx.restore()}},o.prototype.drawTurnedPile=function(){if(this.turnedPile.length>0){var t=this.turnedPile[this.turnedPile.length-1];this.drawCard(t)}},o.prototype.drawFacedownCard=function(t){this.ctx.save(),this.ctx.scale(this.ctx.canvas.height,this.ctx.canvas.height),this.ctx.translate(t.x,t.y),this.ctx.fillStyle="rgb(233, 233, 233)",this.ctx.fillRect(0,0,this.cardWidth,this.cardHeight);var e=.03;this.ctx.fillStyle="rgb(150, 150, 255)",this.ctx.fillRect(e*this.cardWidth,e*this.cardHeight,(1-2*e)*this.cardWidth,(1-2*e)*this.cardHeight),this.ctx.restore()},o.prototype.drawFaceupCardBackground=function(t){this.ctx.save(),this.ctx.scale(this.ctx.canvas.height,this.ctx.canvas.height),this.ctx.translate(t.x,t.y),this.ctx.fillStyle="rgb(244, 244, 244)",this.ctx.fillRect(0,0,this.cardWidth,this.cardHeight);var e=.02;this.ctx.fillStyle="rgb(255, 255, 255)",this.ctx.fillRect(e*this.cardWidth,e*this.cardHeight,(1-2*e)*this.cardWidth,(1-2*e)*this.cardHeight),this.ctx.restore()},o.prototype.drawFaceupCard=function(t){this.drawFaceupCardBackground(t),this.ctx.save(),this.ctx.translate((t.x+this.labelMargin)*this.ctx.canvas.height,(t.y+this.labelMargin)*this.ctx.canvas.height),this.ctx.save();var e=this.ctx.canvas.height*this.fontHeight/this.font.size.y;this.ctx.scale(e,e),this.font.drawString(this.ctx,o.RANKS[t.rank]),this.ctx.restore(),this.ctx.translate(this.font.size.x/this.font.size.y*this.fontHeight*(String(o.RANKS[t.rank]).length+1)*this.ctx.canvas.height,0);var i=this.ctx.canvas.height*this.fontHeight/(this.suitSpriter.size.y+7);this.ctx.scale(i,i),(0,v.default)(this.ctx,!1),this.suitSpriter.drawSprite(this.ctx,o.SUITS[t.suit]),this.ctx.restore()},o.prototype.updateTurnPileCards=function(){for(var t=0;t<this.turnPile.length;t+=1){var e=this.turnPile[t];e.facedown=!0,e.x=this.turnPilePos.x,e.y=this.turnPilePos.y}},o.prototype.updatePileCardPositions=function(){for(var t=0;t<this.piles.length;t+=1)for(var e=this.piles[t],i=this.pilesY,s=0;s<e.length;s+=1){var o=e[s];o.y=i,o.x=this.horizMargin+t*(this.cardWidth+this.horizSpace),i+=o.facedown?this.facedownSpacing:this.faceupSpacing}},o.getNewPiles=function(t){for(var e=[],i=0;i<7;i+=1){e.push([]);for(var s=0;s<i;s+=1){var o=t.pop();o.facedown=!0,o.pile=i,e[i].push(o)}var o=t.pop();o.facedown=!1,o.pile=i,e[i].push(o)}return e},o.prototype.getSortedDeck=function(){for(var t=[],e=0;e<o.SUITS.length;e+=1)for(var i=0;i<o.RANKS.length;i+=1)t.push({rank:i,suit:e,width:this.cardWidth,height:this.cardHeight,next:null,type:"CARD",location:null});return t},o.prototype.getShuffledDeck=function(){for(var t=this.getSortedDeck(),e=[],i=t.length,s=0;s<i;s+=1){var o=this.srng.randomInt(0,t.length-1),n=t[o];e.push(n),t.splice(o,1)}return e},e.default=o},function(t,e){"use strict";function i(t,e){this.work=t,this.delay=e,this.waiting=!1,this.timeout}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.set=function(){this.waiting&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){this.waiting=!1,this.work()}.bind(this),this.delay),this.waiting=!0},i.prototype.clear=function(){this.waiting&&(clearTimeout(this.timeout),this.waiting=!1)},e.default=i},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.touches[0]||t.changedTouches[0];return{x:e.pageX,y:e.pageY}}}]);</script></body></html>
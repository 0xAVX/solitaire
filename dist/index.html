<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Solitaire</title><style>html{box-sizing:border-box}*,:after,:before{box-sizing:inherit}body,html{width:100%;height:100%;margin:0;border:0;padding:0}body{overflow:hidden;background-color:#000}.app-canvas,.app-container{margin:0;border:0;padding:0}.app-canvas{width:100%;height:100%;background-color:#61ad4a}</style></head><body><div class="app-container js-app-container"><canvas class="app-canvas js-app-canvas">Your browser does not support canvas elements.</canvas></div><script>!function(t){function i(s){if(e[s])return e[s].exports;var o=e[s]={exports:{},id:s,loaded:!1};return t[s].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}var e={};return i.m=t,i.c=e,i.p="",i(0)}([function(t,i,e){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function o(){var t=document.body,i=document.querySelector(".js-app-container"),e=document.querySelector(".js-app-canvas"),s=(0,b.default)(M,T,t.offsetWidth,t.offsetHeight);i.style.width=s.width+"px",i.style.height=s.height+"px",e.width=s.width,e.height=s.height;var o=t.offsetWidth-s.width,n=t.offsetHeight-s.height;i.style.marginLeft=Math.floor(o/2)+"px",i.style.marginRight=Math.ceil(o/2)+"px",i.style.marginTop=Math.floor(n/2)+"px",i.style.marginBottom=Math.ceil(n/2)+"px"}var n=e(10),h=s(n),r=e(9),a=s(r),l=e(5),d=s(l),u=e(12),c=s(u),p=e(2),f=(s(p),e(4)),g=s(f),v=e(13),m=s(v),y=e(16),P=s(y),w=e(1),x=s(w),C=e(11),b=s(C),S=e(15),k=s(S);console.log("Hello");var M=16,T=9,z=document.querySelector(".js-app-canvas"),A=z.getContext("2d"),W=new m.default;W.start();var H,E,L,j,B,F;new a.default(h.default,function(t){console.log("Images loaded"),H=t,E=new d.default(H.suits,{x:0,y:0},{x:17,y:19},{x:1,y:0},{clubs:{x:0,y:0},spades:{x:1,y:0},diamonds:{x:2,y:0},hearts:{x:3,y:0}}),L=new c.default(H.font5x14,{x:1,y:1},{x:5,y:14},{x:1,y:1},["AaBbCcDdEeFfGgHhIiJjKkLlMm","NnOoPpQqRrSsTtUuVvWwXxYyZz","`1234567890-=[]\\;',./ ",'~!@#$%^&*()_+{}|:"<>?']),j=new g.default([{top:.15,bottom:.15,type:"mainTitle",text:"Solitaire"},{top:0,bottom:.05,type:"button",text:"Play",id:"play"},{type:"button",text:"About",id:"about"}],{font:L,parent:z,mousedownTracker:W,aspectWidth:M,aspectHeight:T,listeners:[{id:"play",event:"up",action:function(){j.stop(function(){F=new k.default({seed:Math.floor((new Date).getTime()*Math.random()*.007),ctx:A,font:L,suitSpriter:E,mousedownTracker:W,quitCallback:function(){j.start(A)}}),A.clearRect(0,0,z.width,z.height),F.start()})}},{id:"about",event:"up",action:function(){j.stop(function(){A.clearRect(0,0,z.width,z.height),console.log("Go to About menu"),B.start(A)})}}]}),B=new g.default([{top:.08,bottom:.01,type:"title",text:"Solitaire"},{top:0,bottom:.08,type:"subtitle",text:"Version 0.0.2"},{top:0,bottom:.05,type:"button",text:"Author: Costava",id:"author"},{top:0,bottom:.05,type:"button",text:"View source on GitHub",id:"source"},{type:"button",text:"Back",id:"back"}],{font:L,parent:z,mousedownTracker:W,aspectWidth:M,aspectHeight:T,listeners:[{id:"author",event:"up",action:function(){console.log("See author"),window.open("https://github.com/Costava","_blank")}},{id:"source",event:"up",action:function(){console.log("See source"),window.open("https://github.com/Costava/solitaire","_blank")}},{id:"back",event:"up",action:function(){B.stop(function(){A.clearRect(0,0,z.width,z.height),console.log("Go back to main menu"),j.start(A)})}}]}),j.start(A)});var I=new P.default(o,150),O=new x.default(window,"resize",I.set.bind(I));O.start(),o()},function(t,i){"use strict";function e(t,i,e){this.target=t,this.eventType=i,this.work=e,this.active=!1}Object.defineProperty(i,"__esModule",{value:!0}),e.prototype.start=function(){this.active||(this.target.addEventListener(this.eventType,this.work),this.active=!0)},e.prototype.stop=function(){this.active&&(this.target.removeEventListener(this.eventType,this.work),this.active=!1)},i.default=e},function(t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t,i){t.mozImageSmoothingEnabled=i,t.webkitImageSmoothingEnabled=i,t.msImageSmoothingEnabled=i,t.imageSmoothingEnabled=i}},function(t,i){"use strict";function e(t){this.regWork=t.regWork,this.finalWork=t.finalWork,this.stopCallback=t.stopCallback||e.default.stopCallback,this.interval=t.interval||e.default.interval,this.maxNumIntervals=t.maxNumIntervals||e.default.maxNumIntervals,this.time=0,this.totalTime=0,this.looping=!1,this.stopped=!0,this.loopCallBound=this.loopCall.bind(this)}Object.defineProperty(i,"__esModule",{value:!0}),e.default={stopCallback:function(){},interval:8,maxNumIntervals:4},e.prototype.accumulate=function(t){this.time+=t,this.totalTime+=t},e.prototype.loopCall=function(){this.newTime=(new Date).getTime(),this.dt=this.newTime-this.oldTime,this.accumulate(this.dt);var t,i=Math.floor(this.time/this.interval),e=Math.min(i,this.maxNumIntervals);for(t=0;t<e;t+=1){var s=this.regWork();if(!s){t+=1;break}}t>0&&(this.time-=t*this.interval,this.finalWork()),this.oldTime=this.newTime,this.looping?window.requestAnimationFrame(this.loopCallBound):(this.stopped=!0,this.stopCallback())},e.prototype.start=function(){this.stopped&&(this.oldTime=(new Date).getTime(),this.looping=!0,this.stopped=!1,this.loopCallBound())},e.prototype.stop=function(){this.looping=!1},e.prototype.clearTime=function(){this.time=0},e.prototype.resetTime=function(){this.time=0,this.totalTime=0},i.default=e},function(t,i,e){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function o(t,i){this.elements=t,this.options=i,"number"!=typeof this.options.xCenter&&(this.options.xCenter=.5*this.options.aspectWidth/this.options.aspectHeight),this.running=!1,this.armed=!1;var e=0;this.elements.forEach(function(t){e+=t.top||0,t.y=e;var i=this.styles[t.type].fontSize,s=this.options.font.getStringSize(t.text);t.width=s.width/s.height*i,o.isButton(t)&&(t.width+=2*this.styles[t.type].padding,t.buttonState="normal",e+=2*this.styles[t.type].padding),t.x=-t.width/2+this.options.xCenter,e+=i,t.height=e-t.y,e+=t.bottom||0}.bind(this)),this.mousemoveLS=new a.default(window,"mousemove",o.handleMousemove.bind(this)),this.mousedownLS=new a.default(window,"mousedown",o.handleMousedown.bind(this)),this.mouseupLS=new a.default(window,"mouseup",o.handleMouseup.bind(this))}Object.defineProperty(i,"__esModule",{value:!0});var n=e(3),h=s(n),r=e(1),a=s(r),l=e(8),d=s(l),u=e(6),c=s(u),p=e(7),f=s(p);o.prototype.styles={mainTitle:{fontSize:.15},title:{fontSize:.1},subtitle:{fontSize:.06},button:{fontSize:.07,padding:.015,backgroundColor:{normal:"rgb(255, 255, 255)",hover:"rgb(220, 220, 220)",down:"rgb(53, 94, 41)"}},gameButton:{fontSize:.0455,padding:.012,backgroundColor:{normal:"rgb(255, 255, 255)",hover:"rgb(220, 220, 220)",down:"rgb(53, 94, 41)"}}},o.isButton=function(t){return"button"==t.type||"gameButton"==t.type},o.prototype.draw=function(t){t.save(),this.elements.forEach(function(i){t.save(),t.translate(i.x*t.canvas.height,i.y*t.canvas.height),o.isButton(i)?this.drawButton(t,i):this.drawFontElement(t,i),t.restore()}.bind(this)),t.restore()},o.prototype.drawFontElement=function(t,i){t.save();var e=this.styles[i.type].fontSize,s=e*t.canvas.height/this.options.font.size.y;t.scale(s,s),this.options.font.drawString(t,i.text),t.restore()},o.prototype.drawButton=function(t,i){t.save(),t.scale(t.canvas.height,t.canvas.height),t.fillStyle=this.styles[i.type].backgroundColor[i.buttonState],t.fillRect(0,0,i.width,i.height),t.restore(),t.save(),t.translate(this.styles[i.type].padding*t.canvas.height,this.styles[i.type].padding*t.canvas.height),this.drawFontElement(t,i),t.restore()},o.prototype.start=function(t){this.running||(this.ctx=t,this.arm(),this.dualLooper=new h.default({regWork:function(){},finalWork:function(){this.draw(this.ctx)}.bind(this)}),this.dualLooper.start(),this.running=!0)},o.prototype.stop=function(t){this.running&&(this.disarm(),this.stopWork=t,this.dualLooper.stopCallback=function(){this.running=!1,this.stopWork()}.bind(this),this.dualLooper.stop())},o.prototype.arm=function(){this.armed||(this.mousemoveLS.start(),this.mousedownLS.start(),this.mouseupLS.start(),this.armed=!0)},o.prototype.disarm=function(){this.armed&&(this.mousemoveLS.stop(),this.mousedownLS.stop(),this.mouseupLS.stop(),this.armed=!1)},o.handleMousemove=function(t){var i=(0,c.default)(t,this.options.parent);this.updateButtonStates(i)},o.handleMousedown=function(t){var i=(0,c.default)(t,this.options.parent);this.updateButtonStates(i)},o.handleMouseup=function(t){var i=(0,c.default)(t,this.options.parent);this.updateButtonStates(i);for(var e=0;e<this.elements.length;e+=1){var s=this.elements[e];if(o.isButton(s)){var n=(0,f.default)(s,i);if(n)for(var h=0;h<this.options.listeners.length;h+=1){var r=this.options.listeners[h];r.id==s.id&&"up"==r.event&&r.action()}}}},o.prototype.updateButtonStates=function(t){for(var i=!1,e=0;e<this.elements.length;e+=1){var s=this.elements[e];if(o.isButton(s)){var n=(0,f.default)(s,t);n?(i=!0,this.options.mousedownTracker.mousedown?s.buttonState="down":s.buttonState="hover"):s.buttonState="normal"}}i?(0,d.default)("pointer"):(0,d.default)("")},i.default=o},function(t,i){"use strict";function e(t,i,e,s,o){this.image=t,this.origin=i,this.size=e,this.margin=s,this.map=o}Object.defineProperty(i,"__esModule",{value:!0}),e.prototype.getSpriteOrigin=function(t){return{x:this.origin.x+t.x*(this.size.x+this.margin.x),y:this.origin.y+t.y*(this.size.y+this.margin.y)}},e.prototype.drawSprite=function(t,i){var e=this.map[i],s=this.getSpriteOrigin(e);t.drawImage(this.image,s.x,s.y,this.size.x,this.size.y,0,0,this.size.x,this.size.y)},i.default=e},function(t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t,i){return{x:(t.pageX-i.offsetLeft)/i.offsetHeight,y:(t.pageY-i.offsetTop)/i.offsetHeight}}},function(t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t,i){if(i.x>t.x&&i.y>t.y){var e=i.x-t.x,s=i.y-t.y;if(e<t.width&&s<t.height)return!0}return!1}},function(t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t){document.body.style.cursor=t}},function(t,i){"use strict";function e(t,i){this.callback=i,this.totalImages=Object.keys(t).length,this.imagesLoaded=0,this.result={},this.doneLoading=!1;for(var e in t){var s=new Image;s.addEventListener("load",function(){this.loader.imagesLoaded+=1,this.loader.result[this.name]=this,this.loader.check()}),s.loader=this,s.name=e,s.src=t[e]}}Object.defineProperty(i,"__esModule",{value:!0}),e.prototype.check=function(){this.doneLoading||this.totalImages!=this.imagesLoaded||(this.doneLoading=!0,this.callback(this.result))},i.default=e},function(t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default={font5x14:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJ0AAAA9CAYAAAC3Oms4AAAEGUlEQVR42u1d25KsIAwkU/7/L/e+7Kma43JJQoKo3S9b5WLE2OQCgSmFIBZDfv+i878a0JEjivZe+bV2EiC/1h5f1z3ypdHPCP2MnhfRH4881f1H4yVhIKymk1YlrpavUbosGvxS7omeAfgPHxr71yGL2KKVTdLdhygR92VbUpXsY+LFsMj1ZPUHg9gWg7BDnETx6E0CSLCN6x7FdL0At/VCMCgsIgHo3aftvza2kgn9zBABQffNJG0RrhylFDmMI8yTYESPYknuT0nuz5UzFaMEKaP/fxKMwzgK3hQPPRHSsD6rngkN6e40kqPjobcQb8V0jbRiuqiAGEo5YrieIT/KYkYMxFECs8KCy0RsTrzYleMOoQXn6QiSjnhHUEnEulPZqE/8vgTRS5c1pS2WEb66vXUZbLY/U6U+D2mv/l6HQfBI6bu1t5YueQYnUScYtImEFM7eE3+5ED7QPp2HESSRN5Hpyj8WdjCbzJasTYKyPM9KwtXEk6T2ar4cwR/TWkoUmWCIMQCOKM2yxnqt/p0XxWcSvN57ZcpXfy/Pgr8Y269MMEZVFBIxUm8INAZni+xRbrWaYHxuoKwItyLKePVfG2wS245CnYgihCzCff8P3212J50nsendI8EkXR231j40lNetciL7KN+6PxKsEJLlRJcSlTJfziMNF9aKO2vye5W9PdelfZbF7XoGdHZp2Tbuk9M7N/x+rDIhloOkI5bjoAoIhjPE46GdUR/NEWk22YgyTb/y+uzoF4V+xPmMzE3Q25nO2kQpDPf22s9Oi1jlw9j/CJeDgOdg0bdenkj0JhqjrAI9i21wZxmXS7/f0VCKkFxDy0DdBGavlrU4y8lGs5u2I05J8pIrkmCaM0Uea+VapCtl7kSgVunOiKylY2W91SfWA4DkQkvXq8d7lFU97jxiLsjys63d463cOZEgnkXsbUHS7ZXJWkvDoby+lWeynE93jjkQoEQo4rKZJCCy/UxCRRCPAYlNEARBEARBbB2sepaSoAh8R9v9elMC6DxT++zMoB5BCQCC+rvN1srPYvLWSGz5hcPzlrbaLxW2av9au6yi3i1T/soB8RjSnddUW/NZSFDq6GiJ2YKAqzxK7b6RjO1+pql3xoXXFWj2UY6I4tmP+YYlpdqEtDT+Jzu/ABoE0MZWvRgERb90M7JclpjOUtmriYcQIH82prNWVs9a03Sfr+koBvGahZAwKhEOwkS5TATJ166Zet0xHEnb8phOnK4JpV4DpzXrnjPddju4cVSCnvnTR9KI6aTojki7PKbzBp8S/NF2jsdkQ9lag7GNXjXZa88ki8HFoJEkeJRiKYK8yhLtGLfj7p21JhJFEYPA2J+ZeOwuk8OPIx13NI3JIEnPoe6Jy8n9GrBcnSDpCIIgwvEDV7H1CorcrpoAAAAASUVORK5CYII=",suits:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEcAAAATCAYAAADCrxD+AAAA7UlEQVRYw9VYyw7EIAgE0v//ZfbUZLPRdWTGakl6KUic4SFq1pdsfIyw628nEj+IeAGIk8S4ghgn/KByFSKckwCTXC/PtG9i/+lj/d40JfYLAimvns39f6SPDcRIe1C1NyH62ETMlN0owqskGqcTCkpVMo+dPlVyUpQhqc40tjxYclTzyxFz0KqyOk6S6EnsHORmfjQ5KMCeXZWgp+ac1xDcso+3g0PAVzMwBKO8s3cm0Xo5yTHYmIN6E/tZ0lNm/VwTkXNRBvjuMkVv96ONpgjUcU8WaZYjH7Fh+j1i2AMb+fS0yrzl0OWFRFwlH0+EVh6LhLYsAAAAAElFTkSuQmCC"}},function(t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t,i,e,s){if(e<=0||s<=0)return{width:0,height:0};if(t<0||i<0||0===t&&0===i)return{width:0,height:0};if(0===t)return{width:0,height:s};if(0===i)return{width:e,height:0};var o,n,h=t/i,r=e/s;if(h===r)o=e,n=s;else if(h<r){var a=Math.floor(s/i);o=a*t,n=a*i}else if(h>r){var a=Math.floor(e/t);o=a*t,n=a*i}else console.log("Unknown MaxChildSize condition. "+("childAspectWidth: "+t+", ")+("childAspectHeight: "+i+", ")+("parentWidth: "+e+", ")+("parentHeight: "+s));return{width:o,height:n}}},function(t,i,e){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function o(t,i,e,s,o){this.image=t,this.origin=i,this.size=e,this.margin=s,this.map={};for(var n=0;n<o.length;n+=1)for(var r=o[n],a=0;a<r.length;a+=1){var l=r[a];this.map[l]={x:a,y:n}}this.spriter=new h.default(this.image,this.origin,this.size,this.margin,this.map)}Object.defineProperty(i,"__esModule",{value:!0});var n=e(5),h=s(n),r=e(2),a=s(r);o.prototype.drawChar=function(t,i){t.save(),(0,a.default)(t,!1);try{this.spriter.drawSprite(t,i)}catch(i){this.spriter.drawSprite(t,"?")}t.restore()},o.prototype.drawString=function(t,i){t.save();for(var e=0;e<i.length;e+=1)this.drawChar(t,i[e]),t.translate(this.size.x+this.margin.x,0);t.restore()},o.prototype.getStringSize=function(t){return{width:t.length*this.size.x+(t.length-1)*this.margin.x,height:this.size.y}},i.default=o},function(t,i,e){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function o(){this.mousedown=!1,this.mousedownLS=new h.default(window,"mousedown",function(){this.mousedown=!0}.bind(this)),this.mouseupLS=new h.default(window,"mouseup",function(){this.mousedown=!1}.bind(this))}Object.defineProperty(i,"__esModule",{value:!0});var n=e(1),h=s(n);o.prototype.start=function(){this.mousedownLS.start(),this.mouseupLS.start()},o.prototype.stop=function(){this.mousedownLS.stop(),this.mouseupLS.stop()},i.default=o},function(t,i){"use strict";function e(t){this.seed=t||10}Object.defineProperty(i,"__esModule",{value:!0}),e.prototype.random=function(){this.seed+=1;var t=1e5*Math.sin(this.seed);return t-Math.floor(t)},e.prototype.randomInt=function(t,i){return Math.floor(this.random()*(i-t+1))+t},e.prototype.randomInRange=function(t,i){return this.random()*(i-t)+t},i.default=e},function(t,i,e){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function o(t){this.ctx=t.ctx,this.font=t.font,this.suitSpriter=t.suitSpriter,this.mousedownTracker=t.mousedownTracker,this.quitCallback=t.quitCallback,this.srng=new h.default(t.seed),this.aspectWidth=t.aspectWidth||16,this.aspectHeight=t.aspectHeight||9,this.running=!1,this.armed=!1,this.labelMargin=.01,this.fontHeight=.04,this.cardWidth=.18,this.cardHeight=.27,this.horizSpace=.036,this.facedownSpacing=.02,this.faceupSpacing=this.labelMargin+this.fontHeight,this.pilesY=0+this.cardHeight+2*this.horizSpace,this.horizMargin=(1*(this.aspectWidth/this.aspectHeight)-7*this.cardWidth-6*this.horizSpace)/2,this.turnPilePos={x:this.horizMargin,y:this.horizSpace,width:this.cardWidth,height:this.cardHeight},this.turnedPilePos={x:this.horizMargin+this.cardWidth+this.horizSpace,y:this.horizSpace,width:this.cardWidth,height:this.cardHeight},this.mousemoveLS=new d.default(window,"mousemove",o.handleMousemove.bind(this)),this.mousedownLS=new d.default(window,"mousedown",o.handleMousedown.bind(this)),this.mouseupLS=new d.default(window,"mouseup",o.handleMouseup.bind(this)),this.buttonsMenu=new c.default([{top:2.34*this.horizSpace,type:"gameButton",text:"Quit",id:"quit"},{top:this.horizSpace,type:"gameButton",text:"New Game",id:"newgame"}],{font:this.font,parent:this.ctx.canvas,mousedownTracker:this.mousedownTracker,aspectWidth:this.aspectWidth,aspectHeight:this.aspectHeight,xCenter:this.horizMargin+2.5*this.cardWidth+2*this.horizSpace,listeners:[{id:"quit",event:"up",action:function(){console.log("Quit"),this.stop(function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.quitCallback()}.bind(this))}.bind(this)},{id:"newgame",event:"up",action:function(){this.newGame()}.bind(this)}]}),this.newGame()}Object.defineProperty(i,"__esModule",{value:!0});var n=e(14),h=s(n),r=e(3),a=s(r),l=e(1),d=s(l),u=e(4),c=s(u),p=e(8),f=s(p),g=e(6),v=s(g),m=e(2),y=s(m),P=e(7),w=s(P);o.prototype.newGame=function(){console.log("New game. Seed:",this.srng.seed),this.heldCard=null,this.hoverPos=null,this.foundations=[[],[],[],[]],this.foundationPos=this.getFoundationPos();var t=this.getShuffledDeck();this.piles=o.getNewPiles(t),this.pileBasePos=this.getPileBasePos(),this.turnPile=t,this.turnedPile=[],this.updateTurnPileCards(),this.updatePileCardPositions()},o.prototype.start=function(){this.running||(console.log("Start Solitaire"),this.arm(),this.dualLooper=new a.default({regWork:function(){},finalWork:function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.drawTurnPile(),this.drawTurnedPile(),this.drawPiles(),this.drawFoundations(),this.drawHoverPos(),this.drawHeldCards()}.bind(this)}),this.dualLooper.start(),this.buttonsMenu.start(this.ctx),this.running=!0)},o.prototype.stop=function(t){this.running&&(console.log("Stop Solitaire"),this.disarm(),this.stopWork=t,this.buttonsMenu.stop(function(){this.dualLooper.stopCallback=function(){this.running=!1,this.stopWork()}.bind(this),this.dualLooper.stop()}.bind(this)))},o.prototype.arm=function(){this.armed||(this.mousemoveLS.start(),this.mousedownLS.start(),this.mouseupLS.start(),this.armed=!0)},o.prototype.disarm=function(){this.armed&&(this.mousemoveLS.stop(),this.mousedownLS.stop(),this.mouseupLS.stop(),this.armed=!1)},o.moveCard=function(t,i,e){null!=t&&(t.x+=i,t.y+=e,o.moveCard(t.next,i,e))},o.handleMousemove=function(t){var i=(0,v.default)(t,this.ctx.canvas);if(null==this.heldCard&&(this.turnPile.length>0||this.turnedPile.length>0)){var e=this.turnPilePos;if((0,w.default)(e,i))return void(0,f.default)("pointer")}if(this.hoverPos=this.getHoverPos(i),null!=this.hoverPos&&this.hoverPos.onTurnedPile&&null!=this.heldCard&&(this.hoverPos=null),null!=this.heldCard){var s=t.movementX/this.ctx.canvas.height,n=t.movementY/this.ctx.canvas.height;o.moveCard(this.heldCard,s,n)}null!=this.heldCard||null!=this.hoverPos?(0,f.default)("pointer"):(0,f.default)("")},o.handleMousedown=function(t){var i=(0,v.default)(t,this.ctx.canvas);if(this.turnPile.length>0||this.turnedPile.length>0){var e=this.turnPile[this.turnPile.length-1]||this.turnPilePos;if((0,w.default)(e,i)){if(this.turnPile.length>0)return this.turnCard(),void(this.turnPile.length>0?(0,f.default)("pointer"):(0,f.default)(""));this.resetTurnPile()}}if(this.turnedPile.length>0&&(0,w.default)(this.turnedPilePos,i)&&null==this.heldCard)return this.heldCard=this.turnedPile[this.turnedPile.length-1],this.heldCard.onTurnedPile=!1,this.heldCard.fromTurnedPile=!0,this.turnedPile.pop(),void(0,f.default)("pointer");var s=this.getHoverPos(i);null==this.heldCard&&null!=s?(this.heldCard=s,this.removeCardFromPile(this.heldCard.pile,this.heldCard),this.hoverPos=this.getHoverPos(i)):this.hoverPos=s,null!=this.heldCard||null!=this.hoverPos?(0,f.default)("pointer"):(0,f.default)("")},o.handleMouseup=function(t){var i=(0,v.default)(t,this.ctx.canvas);if(null==this.heldCard&&(this.turnPile.length>0||this.turnedPile.length>0)){var e=this.turnPile[this.turnPile.length-1]||this.turnPilePos;if((0,w.default)(e,i))return void(0,f.default)("pointer")}if(this.hoverPos=this.getHoverPos(i),null!=this.heldCard&&this.heldCard.fromTurnedPile){if(o.canPutOn(this.hoverPos,this.heldCard)){if(this.hoverPos.onFoundation||this.hoverPos.isFoundationBase){var s=this.foundations[this.hoverPos.foundation];this.heldCard.x=this.hoverPos.x,this.heldCard.y=this.hoverPos.y,this.heldCard.foundation=this.hoverPos.foundation,this.heldCard.onFoundation=!0,s.push(this.heldCard)}else this.addCardToPile(this.hoverPos.pile,this.heldCard),this.heldCard.pile=this.hoverPos.pile,this.updatePileCardPositions();this.heldCard.fromTurnedPile=!1,this.heldCard.onTurnedPile=!1}else this.turnedPile.push(this.heldCard),this.heldCard.onTurnedPile=!0,this.heldCard.fromTurnedPile=!1,this.heldCard.x=this.turnedPilePos.x,this.heldCard.y=this.turnedPilePos.y;return this.heldCard=null,this.hoverPos=this.getHoverPos(i),void(null!=this.hoverPos?(0,f.default)("pointer"):(0,f.default)(""))}if(null!=this.hoverPos&&(this.hoverPos.isFoundationBase||this.hoverPos.onFoundation)&&null!=this.heldCard){var n,s=this.foundations[this.hoverPos.foundation];n=0==s.length?this.hoverPos:s[s.length-1];var h=o.canPutOn(n,this.heldCard);if(h){this.heldCard.x=this.hoverPos.x,this.heldCard.y=this.hoverPos.y,this.heldCard.foundation=this.hoverPos.foundation,this.heldCard.onFoundation=!0,s.push(this.heldCard);var r=this.piles[this.heldCard.pile];return r.length>0&&(r[r.length-1].facedown=!1),void(this.heldCard=null)}}if(null!=this.hoverPos&&null!=this.heldCard&&o.canPutOn(this.hoverPos,this.heldCard)){var a=this.heldCard.pile;this.addCardToPile(this.hoverPos.pile,this.heldCard);var r=this.piles[a];r.length>0&&(r[r.length-1].facedown=!1),this.heldCard.pile=this.hoverPos.pile}else null!=this.heldCard&&this.addCardToPile(this.heldCard.pile,this.heldCard);this.heldCard=null,this.hoverPos=this.getHoverPos(i),this.updatePileCardPositions(),null!=this.heldCard||null!=this.hoverPos?(0,f.default)("pointer"):(0,f.default)("")},o.prototype.resetTurnPile=function(){if(0==this.turnPile.length&&this.turnedPile.length>0){this.turnPile=this.turnedPile.reverse(),this.turnedPile=[];for(var t=0;t<this.turnPile.length;t+=1){var i=this.turnPile[t];i.x=this.turnPilePos.x,i.y=this.turnPilePos.y,i.facedown=!0}}},o.prototype.turnCard=function(){if(this.turnPile.length>0){var t=this.turnPile.pop();t.facedown=!1,t.onTurnedPile=!0,t.x=this.horizMargin+this.cardWidth+this.horizSpace,t.y=this.horizSpace,this.turnedPile.push(t)}},o.canPutOn=function(t,i){if(null==t||null==i)return!1;if(t.isPileBase&&12==i.rank)return!0;if(t.isFoundationBase&&0==i.rank)return!0;if(t.onFoundation&&i.rank==t.rank+1&&i.suit==t.suit)return!0;var e=t.suit%2!=i.suit%2;return!!e&&i.rank==t.rank-1},o.prototype.addCardToPile=function(t,i){if(null!=i){var e=this.piles[t];if(e.length>0){var s=e[e.length-1];s.next=i}i.pile=t,e.push(i),this.addCardToPile(t,i.next)}},o.prototype.removeCardFromPile=function(t,i){if(null!=i){var e=this.piles[t],s=e.indexOf(i);e.splice(s,1),e.length>0&&s>0&&(e[s-1].next=null),this.removeCardFromPile(t,i.next)}},o.prototype.getHoverPos=function(t){if((0,w.default)(this.turnedPilePos,t)&&this.turnedPile.length>0){var i=this.turnedPile[this.turnedPile.length-1];return i}for(var e=0;e<this.foundations.length;e+=1){var s,n=this.foundations[e];if(s=0==n.length?this.foundationPos[e]:n[n.length-1],null!=this.heldCard&&o.canPutOn(s,this.heldCard)&&(0,w.default)(s,t))return s}for(var h=0;h<this.piles.length;h+=1){var r=this.piles[h];if(0==r.length){if(null!=this.heldCard&&12==this.heldCard.rank){var a=this.pileBasePos[h];if((0,w.default)(a,t))return a}}else for(var l=r.length-1;l>=0;l-=1){var d=r[l];if((null!=this.heldCard&&o.canPutOn(d,this.heldCard)||null==this.heldCard)&&!d.facedown&&this.heldCard!=d&&(0,w.default)(d,t))return d}}return null},o.prototype.drawHoverPos=function(){if(null!=this.hoverPos){this.ctx.save();var t=.1;this.ctx.scale(this.ctx.canvas.height,this.ctx.canvas.height),this.ctx.translate(this.hoverPos.x-t*this.cardWidth,this.hoverPos.y-t*this.cardHeight),this.ctx.fillStyle="rgba(255, 255, 255, 0.4)",this.ctx.fillRect(0,0,(1+2*t)*this.cardWidth,(1+2*t)*this.cardHeight),this.ctx.restore()}},o.prototype.drawHeldCards=function(){this.tryDrawCard(this.heldCard)},o.prototype.tryDrawCard=function(t){null!=t&&(this.drawCard(t),this.tryDrawCard(t.next))},o.prototype.drawCard=function(t){t.facedown?this.drawFacedownCard(t):this.drawFaceupCard(t)},o.prototype.drawPiles=function(){for(var t=0;t<this.piles.length;t+=1)for(var i=this.piles[t],e=0;e<i.length;e+=1){var s=i[e];this.drawCard(s)}},o.prototype.getFoundationPos=function(){for(var t=[],i=0;i<this.foundations.length;i+=1){var e=this.horizSpace,s=this.aspectWidth/this.aspectHeight-this.horizMargin;s-=(i+1)*this.cardWidth,s-=i*this.horizSpace,t.push({x:s,y:e,width:this.cardWidth,height:this.cardHeight,foundation:i,isFoundationBase:!0})}return t},o.prototype.drawFoundations=function(){for(var t=0;t<this.foundations.length;t+=1){var i=this.foundations[t];if(0==i.length){var e=this.foundationPos[t];this.ctx.save(),this.ctx.scale(this.ctx.canvas.height,this.ctx.canvas.height),this.ctx.translate(e.x,e.y),this.ctx.fillStyle="rgb(100, 100, 100)",this.ctx.fillRect(0,0,this.cardWidth,this.cardHeight),this.ctx.restore()}else{var s=i[i.length-1];this.drawFaceupCard(s)}}},o.prototype.updateTurnPileCards=function(){for(var t=0;t<this.turnPile.length;t+=1){var i=this.turnPile[t];i.facedown=!0,i.x=this.horizMargin,i.y=this.horizSpace}},o.prototype.drawTurnPile=function(){if(this.turnPile.length>0){var t=this.turnPile[this.turnPile.length-1];this.drawCard(t)}else if(this.turnedPile.length>0){var i=this.turnPilePos;this.ctx.save(),this.ctx.scale(this.ctx.canvas.height,this.ctx.canvas.height),this.ctx.translate(i.x,i.y),this.ctx.fillStyle="rgb(100, 100, 100)",this.ctx.fillRect(0,0,this.cardWidth,this.cardHeight),this.ctx.restore()}},o.prototype.drawTurnedPile=function(){if(this.turnedPile.length>0){var t=this.turnedPile[this.turnedPile.length-1];this.drawCard(t)}},o.prototype.drawFacedownCard=function(t){this.ctx.save(),this.ctx.scale(this.ctx.canvas.height,this.ctx.canvas.height),this.ctx.translate(t.x,t.y),this.ctx.fillStyle="rgb(233, 233, 233)",this.ctx.fillRect(0,0,this.cardWidth,this.cardHeight);var i=.03;this.ctx.fillStyle="rgb(150, 150, 255)",this.ctx.fillRect(i*this.cardWidth,i*this.cardHeight,(1-2*i)*this.cardWidth,(1-2*i)*this.cardHeight),this.ctx.restore()},o.prototype.drawFaceupCardBackground=function(t){this.ctx.save(),this.ctx.scale(this.ctx.canvas.height,this.ctx.canvas.height),this.ctx.translate(t.x,t.y),this.ctx.fillStyle="rgb(244, 244, 244)",this.ctx.fillRect(0,0,this.cardWidth,this.cardHeight);var i=.02;this.ctx.fillStyle="rgb(255, 255, 255)",this.ctx.fillRect(i*this.cardWidth,i*this.cardHeight,(1-2*i)*this.cardWidth,(1-2*i)*this.cardHeight),this.ctx.restore()},o.prototype.drawFaceupCard=function(t){this.drawFaceupCardBackground(t),this.ctx.save(),this.ctx.translate((t.x+this.labelMargin)*this.ctx.canvas.height,(t.y+this.labelMargin)*this.ctx.canvas.height),this.ctx.save();var i=this.ctx.canvas.height*this.fontHeight/this.font.size.y;this.ctx.scale(i,i),this.font.drawString(this.ctx,o.ranks[t.rank]),this.ctx.restore(),this.ctx.translate(this.font.size.x/this.font.size.y*this.fontHeight*(String(o.ranks[t.rank]).length+1)*this.ctx.canvas.height,0);var e=this.ctx.canvas.height*this.fontHeight/(this.suitSpriter.size.y+7);this.ctx.scale(e,e),(0,y.default)(this.ctx,!1),this.suitSpriter.drawSprite(this.ctx,o.suits[t.suit]),this.ctx.restore()},o.prototype.getPileBasePos=function(){for(var t=[],i=0;i<this.piles.length;i+=1){var e={};e.y=this.pilesY,e.x=this.horizMargin+i*(this.cardWidth+this.horizSpace),e.width=this.cardWidth,e.height=this.cardHeight,e.pile=i,e.isPileBase=!0,t.push(e)}return t},o.prototype.updatePileCardPositions=function(){for(var t=0;t<this.piles.length;t+=1)for(var i=this.piles[t],e=this.pilesY,s=0;s<i.length;s+=1){var o=i[s];o.y=e,o.x=this.horizMargin+t*(this.cardWidth+this.horizSpace),e+=o.facedown?this.facedownSpacing:this.faceupSpacing}},o.getNewPiles=function(t){for(var i=[],e=0;e<7;e+=1){i.push([]);for(var s=0;s<e;s+=1){var o=t.pop();o.facedown=!0,o.pile=e,i[e].push(o)}var o=t.pop();o.facedown=!1,o.pile=e,i[e].push(o)}return i},o.prototype.getSortedDeck=function(){for(var t=[],i=0;i<o.suits.length;i+=1)for(var e=0;e<o.ranks.length;e+=1)t.push({rank:e,suit:i,width:this.cardWidth,height:this.cardHeight,next:null});return t},o.prototype.getShuffledDeck=function(){for(var t=this.getSortedDeck(),i=[],e=t.length,s=0;s<e;s+=1){var o=this.srng.randomInt(0,t.length-1),n=t[o];i.push(n),t.splice(o,1)}return i},o.ranks=["A","2","3","4","5","6","7","8","9","10","J","Q","K"],o.suits=["clubs","diamonds","spades","hearts"],i.default=o},function(t,i){"use strict";function e(t,i){this.work=t,this.delay=i,this.waiting=!1,this.timeout}Object.defineProperty(i,"__esModule",{value:!0}),e.prototype.set=function(){this.waiting&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){this.waiting=!1,this.work()}.bind(this),this.delay),this.waiting=!0},e.prototype.clear=function(){this.waiting&&(clearTimeout(this.timeout),this.waiting=!1)},i.default=e}]);</script></body></html>